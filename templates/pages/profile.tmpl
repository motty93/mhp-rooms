{{ define "page" }}
<div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-6xl">
  <!-- メインコンテンツ (PCではグリッドレイアウト) -->
  <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- 左カラム: プロフィールカード -->
    <aside id="profile-card" class="lg:col-span-1">
      <div class="bg-white rounded-xl p-6 shadow-md sticky top-8 border border-gray-200">
        <div class="flex flex-col items-center">
          <!-- アバター -->
          <div class="relative">
            <img 
              class="w-32 h-32 rounded-full mb-4 border-4 border-white object-cover shadow-sm" 
              src="https://placehold.co/150x150/7c3aed/ffffff?text=R" 
              alt="アバター"
            />
            <span class="absolute bottom-4 right-2 bg-green-500 w-5 h-5 rounded-full border-2 border-white" title="オンライン"></span>
          </div>

          <!-- ユーザー名とランク -->
          <h2 class="text-2xl font-bold text-gray-800">rdwbocungelt5</h2>
          <p class="text-sm text-gray-500 mb-4">ハンターランク: HR999</p>

          <!-- 自己紹介 -->
          <p class="text-center text-gray-600 mb-6 text-sm">
            モンハン大好きです！一緒に楽しく狩りに行けるフレンドを募集しています。VCも可能です。よろしくお願いします！
          </p>

          <!-- ステータス情報 -->
          <div class="w-full space-y-3 text-sm mb-6">
            <div class="flex items-center text-gray-500">
              <i class="fa-solid fa-gamepad w-5 mr-2 text-gray-400"></i> 
              主なゲーム: MHRise, MHWorld
            </div>
            <div class="flex items-center text-gray-500">
              <i class="fa-solid fa-clock w-5 mr-2 text-gray-400"></i> 
              プレイ時間帯: 平日夜, 休日
            </div>
            <div class="flex items-center text-gray-500">
              <i class="fa-solid fa-users w-5 mr-2 text-gray-400"></i> 
              フレンド: 25人
            </div>
          </div>

          <!-- プロフィール編集ボタン -->
          <button 
            hx-get="/api/profile/edit-form" 
            hx-target="#profile-card"
            hx-swap="innerHTML"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center space-x-2"
          >
            <i class="fa-solid fa-pencil"></i>
            <span>プロフィールを編集</span>
          </button>
        </div>
      </div>
    </aside>

    <!-- 右カラム: アクティビティ -->
    <section class="lg:col-span-2">
      <div class="bg-white rounded-xl shadow-md border border-gray-200">
        <!-- タブナビゲーション -->
        <div x-data="{ tab: 'activity' }" class="border-b border-gray-200">
          <nav class="flex space-x-2 px-4">
            <!-- アクティビティタブ -->
            <button 
              @click="tab = 'activity'"
              :class="{'border-blue-500 text-blue-600': tab === 'activity', 'border-transparent text-gray-500 hover:text-gray-700': tab !== 'activity'}"
              class="py-4 px-4 block font-medium border-b-2 focus:outline-none transition-colors duration-200"
              hx-get="/api/profile/activity"
              hx-trigger="click"
              hx-target="#tab-content"
              hx-indicator="#tab-loader"
            >
              アクティビティ
            </button>
            <!-- 作成した部屋タブ -->
            <button 
              @click="tab = 'rooms'" 
              :class="{'border-blue-500 text-blue-600': tab === 'rooms', 'border-transparent text-gray-500 hover:text-gray-700': tab !== 'rooms'}"
              class="py-4 px-4 block font-medium border-b-2 focus:outline-none transition-colors duration-200"
              hx-get="/api/profile/rooms"
              hx-trigger="click"
              hx-target="#tab-content"
              hx-indicator="#tab-loader"
            >
              作成した部屋
            </button>
             <!-- フレンドタブ -->
            <button 
              @click="tab = 'friends'" 
              :class="{'border-blue-500 text-blue-600': tab === 'friends', 'border-transparent text-gray-500 hover:text-gray-700': tab !== 'friends'}"
              class="py-4 px-4 block font-medium border-b-2 focus:outline-none transition-colors duration-200"
              hx-get="/api/profile/friends"
              hx-trigger="click"
              hx-target="#tab-content"
              hx-indicator="#tab-loader"
            >
              フレンド
            </button>
          </nav>
        </div>

        <!-- タブコンテンツ -->
        <div class="p-6 relative min-h-[300px]">
          <!-- htmx読み込み中のローディングインジケーター -->
          <div id="tab-loader" class="htmx-indicator absolute inset-0 bg-white bg-opacity-50 flex items-center justify-center">
             <i class="fa-solid fa-spinner fa-spin text-2xl text-blue-600"></i>
          </div>

          <!-- htmxによってコンテンツが挿入される場所 -->
          <div id="tab-content">
            <!-- 初期表示コンテンツ（アクティビティ） -->
            <div>
               <h3 class="text-xl font-bold mb-4 text-gray-800">最近の活動履歴</h3>
               <div class="space-y-4">
                  <!-- 履歴アイテムのカード -->
                  <div class="bg-gray-50 p-4 rounded-lg flex justify-between items-center hover:bg-gray-100 transition-colors border border-gray-200">
                      <div class="flex items-center space-x-4">
                          <i class="fa-solid fa-door-open text-green-500"></i>
                          <div>
                              <p class="font-semibold text-gray-800">【部屋作成】古龍種連戦</p>
                              <p class="text-sm text-gray-500">ターゲット: クシャルダオラ</p>
                          </div>
                      </div>
                      <span class="text-xs text-gray-400">3時間前</span>
                  </div>
                  <div class="bg-gray-50 p-4 rounded-lg flex justify-between items-center hover:bg-gray-100 transition-colors border border-gray-200">
                      <div class="flex items-center space-x-4">
                          <i class="fa-solid fa-right-to-bracket text-blue-500"></i>
                          <div>
                              <p class="font-semibold text-gray-800">【部屋参加】二つ名持ちモンスター</p>
                              <p class="text-sm text-gray-500">ホスト: 素材コレクター</p>
                          </div>
                      </div>
                      <span class="text-xs text-gray-400">昨日</span>
                  </div>
                  <div class="bg-gray-50 p-4 rounded-lg flex justify-between items-center hover:bg-gray-100 transition-colors border border-gray-200">
                       <div class="flex items-center space-x-4">
                          <i class="fa-solid fa-user-plus text-yellow-500"></i>
                          <div>
                              <p class="font-semibold text-gray-800">ハンター太郎さんとフレンドになりました</p>
                          </div>
                      </div>
                      <span class="text-xs text-gray-400">2日前</span>
                   </div>
               </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- htmxのダミーAPIエンドポイント -->
<script>
  // このスクリプトはデモ用です。htmxがどのように動作するかを示します。
  document.body.addEventListener('htmx:configRequest', function(evt) {
      const path = evt.detail.path;
      
      // 編集フォームのダミーレスポンス
      if (path === '/api/profile/edit-form') {
          evt.preventDefault();
          const target = document.querySelector(evt.detail.target);
          target.innerHTML = `
              <div class="p-6">
                  <h3 class="text-xl font-bold text-gray-800 mb-4">プロフィール編集</h3>
                  <div class="space-y-4">
                      <div>
                          <label class="text-sm font-bold text-gray-600 block mb-1">ユーザー名</label>
                          <input type="text" value="rdwbocungelt5" class="w-full bg-gray-100 text-gray-800 rounded-lg p-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                          <label class="text-sm font-bold text-gray-600 block mb-1">自己紹介</label>
                          <textarea class="w-full bg-gray-100 text-gray-800 rounded-lg p-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4">モンハン大好きです！一緒に楽しく狩りに行けるフレンドを募集しています。VCも可能です。よろしくお願いします！</textarea>
                      </div>
                      <div class="flex space-x-2">
                          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">保存</button>
                          <button hx-get="/api/profile/view" hx-target="#profile-card" hx-swap="outerHTML" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition-colors">キャンセル</button>
                      </div>
                  </div>
              </div>
          `;
      }
       // アクティビティタブのダミーレスポンス
      if (path === '/api/profile/activity') {
           evt.preventDefault();
           setTimeout(() => {
              const target = document.querySelector(evt.detail.target);
              target.innerHTML = `
                  <div>
                      <h3 class="text-xl font-bold mb-4 text-gray-800">最近の活動履歴</h3>
                      <p class="text-gray-600">アクティビティのコンテンツがここに表示されます。</p>
                  </div>
              `;
           }, 500); // 500msの遅延をシミュレート
      }
      // 作成した部屋タブのダミーレスポンス
      if (path === '/api/profile/rooms') {
           evt.preventDefault();
           setTimeout(() => {
              const target = document.querySelector(evt.detail.target);
              target.innerHTML = `
                  <div>
                      <h3 class="text-xl font-bold mb-4 text-gray-800">作成した部屋</h3>
                      <p class="text-gray-600">ユーザーが作成した部屋の一覧がここに表示されます。</p>
                  </div>
              `;
           }, 500);
      }
      // フレンドタブのダミーレスポンス
      if (path === '/api/profile/friends') {
           evt.preventDefault();
           setTimeout(() => {
              const target = document.querySelector(evt.detail.target);
              target.innerHTML = `
                  <div>
                      <h3 class="text-xl font-bold mb-4 text-gray-800">フレンドリスト</h3>
                      <p class="text-gray-600">フレンドの一覧がここに表示されます。</p>
                  </div>
              `;
           }, 500);
      }
  });
</script>
{{ end }}

{{ define "head" }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
  /* htmxでコンテンツが読み込まれる際のフェードインアニメーション */
  .htmx-swapping {
      opacity: 0;
      transition: opacity 300ms ease-in-out;
  }
</style>
{{ end }}