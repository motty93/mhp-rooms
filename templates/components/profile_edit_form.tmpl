{{ define "profile_edit_form" }}
  <div
    x-data="profileEditForm()"
    data-init-display-name="{{ .User.DisplayName }}"
    data-init-bio="{{ safeString .User.Bio }}"
    data-init-psn-online-id="{{ safeString .User.PSNOnlineID }}"
    data-init-nintendo-network-id="{{ safeString .User.NintendoNetworkID }}"
    data-init-nintendo-switch-id="{{ safeString .User.NintendoSwitchID }}"
    data-init-twitter-id="{{ safeString .User.TwitterID }}"
    data-init-favorite-games="{{ json .FavoriteGames }}"
    data-init-play-times="{{ json .PlayTimes }}"
    x-init="$data.initFromDataAttributes($el)"
    class="flex flex-col items-center"
  >
    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">
      プロフィール編集
    </h3>

    <form id="profile-edit-form" class="w-full space-y-6">
      <!-- アバター画像 -->
      <div class="flex flex-col items-center">
        <div
          class="relative group cursor-pointer"
          @click="$refs.avatarInput.click()"
        >
          <img
            class="w-24 h-24 rounded-full object-cover shadow-sm"
            src="{{ if .User.AvatarURL }}
              {{ .User.AvatarURL }}
            {{ else }}
              /static/images/default-avatar.webp
            {{ end }}"
            alt="アバター"
          />
          <!-- カメラアイコンオーバーレイ -->
          <div
            class="absolute inset-0 bg-black bg-opacity-40 md:bg-opacity-0 md:group-hover:bg-opacity-40 rounded-full flex items-center justify-center transition-all duration-200"
          >
            <svg
              class="w-6 h-6 text-white"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"
              ></path>
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"
              ></path>
            </svg>
          </div>
        </div>
        <!-- 隠しファイル入力 -->
        <input
          type="file"
          x-ref="avatarInput"
          accept="image/*"
          @change="handleAvatarChange($event)"
          class="hidden"
        />
      </div>

      <!-- 表示名 -->
      <div>
        <label class="text-sm font-bold text-gray-600 block mb-1"
          >表示名（ニックネーム）</label
        >
        <input
          type="text"
          x-model="displayName"
          maxlength="100"
          required
          class="w-full bg-gray-100 text-gray-800 rounded-lg p-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <!-- 自己紹介 -->
      <div>
        <label class="text-sm font-bold text-gray-600 block mb-1"
          >自己紹介</label
        >
        <textarea
          x-model="bio"
          :maxlength="maxBioLength"
          class="w-full bg-gray-100 text-gray-800 rounded-lg p-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
          rows="4"
        ></textarea>
        <p
          class="text-xs text-right"
          :class="bio.length > maxBioLength ? 'text-red-500' : 'text-gray-500'"
        >
          <span x-text="bio.length"></span> /
          <span x-text="maxBioLength"></span>
        </p>
      </div>

      <!-- プラットフォームID -->
      <div class="space-y-4">
        <div>
          <label class="text-sm font-bold text-gray-600 block mb-1"
            >PSN ID</label
          >
          <input
            type="text"
            x-model="psnOnlineId"
            maxlength="16"
            class="w-full bg-gray-100 text-gray-800 rounded-lg p-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
        <div>
          <label class="text-sm font-bold text-gray-600 block mb-1"
            >Nintendo Network ID</label
          >
          <input
            type="text"
            x-model="nintendoNetworkId"
            maxlength="16"
            class="w-full bg-gray-100 text-gray-800 rounded-lg p-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
        <div>
          <label class="text-sm font-bold text-gray-600 block mb-1"
            >Nintendo Switch ID</label
          >
          <input
            type="text"
            x-model="nintendoSwitchId"
            maxlength="20"
            class="w-full bg-gray-100 text-gray-800 rounded-lg p-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
        <div>
          <label class="text-sm font-bold text-gray-600 block mb-1"
            >Twitter ID</label
          >
          <input
            type="text"
            x-model="twitterId"
            maxlength="15"
            class="w-full bg-gray-100 text-gray-800 rounded-lg p-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
      </div>

      <!-- お気に入りゲーム -->
      <div>
        <label class="text-sm font-bold text-gray-600 block mb-2"
          >主なゲーム (複数選択可)</label
        >
        <div class="grid grid-cols-2 gap-2">
          <template x-for="game in availableGames" :key="game">
            <label
              class="flex items-center space-x-2 p-2 rounded-lg bg-gray-50 border border-gray-200 cursor-pointer hover:bg-gray-100 has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400"
            >
              <input
                type="checkbox"
                :value="game"
                x-model="favoriteGames"
                class="rounded text-blue-600 focus:ring-blue-500"
              />
              <span class="text-sm text-gray-700" x-text="game"></span>
            </label>
          </template>
        </div>
      </div>

      <!-- プレイ時間帯 -->
      <div>
        <label class="text-sm font-bold text-gray-600 block mb-2"
          >プレイ時間帯</label
        >
        <div class="grid grid-cols-1 gap-3">
          <div>
            <label class="text-sm text-gray-600 block mb-1">平日</label>
            <select
              x-model="playTimes.weekday"
              class="w-full bg-gray-100 text-gray-800 rounded-lg p-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="">未設定</option>
              <option value="朝">朝（6:00-12:00）</option>
              <option value="昼">昼（12:00-18:00）</option>
              <option value="夜">夜（18:00-24:00）</option>
              <option value="深夜">深夜（24:00-6:00）</option>
              <option value="不定期">不定期</option>
            </select>
          </div>
          <div>
            <label class="text-sm text-gray-600 block mb-1">休日</label>
            <select
              x-model="playTimes.weekend"
              class="w-full bg-gray-100 text-gray-800 rounded-lg p-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="">未設定</option>
              <option value="朝">朝（6:00-12:00）</option>
              <option value="昼">昼（12:00-18:00）</option>
              <option value="夜">夜（18:00-24:00）</option>
              <option value="深夜">深夜（24:00-6:00）</option>
              <option value="一日中">一日中</option>
              <option value="不定期">不定期</option>
            </select>
          </div>
        </div>
      </div>

      <!-- 保存・キャンセルボタン -->
      <div class="flex space-x-2 pt-4">
        <button
          type="submit"
          @click.prevent="saveProfile()"
          class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors"
        >
          保存する
        </button>
        <button
          type="button"
          hx-get="/profile/view"
          hx-target="#profile-card-content"
          hx-swap="innerHTML"
          class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition-colors"
        >
          キャンセル
        </button>
      </div>
    </form>
  </div>
{{ end }}
