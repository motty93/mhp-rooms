# パスワード付き部屋の🔑アイコン表示バグ修正

## 実装期間
- 開始: 2025-10-28 13:00
- 完了: 2025-10-28 13:02
- 所要時間: 約2分

## 対応したissue
- GitHub Issue #66: 部屋一覧でパスワード付きの部屋に🔑アイコンがつかない問題

## 問題の概要
パスワード付きの部屋を作成しても、部屋一覧で🔑アイコンが表示されない問題が発生していました。

## 原因
`templates/pages/rooms.tmpl`の1055行目で、サーバーから送られてこない`password_hash`フィールドを参照していたため、初回ページ読み込み時に🔑アイコンが表示されませんでした。

### 詳細な原因分析
1. **サーバー側**: `internal/handlers/rooms.go`では、APIレスポンスに`has_password`フィールドを設定していた
2. **テンプレート側**: JavaScript内で`room.password_hash`を参照していた
3. **結果**: フィールド名の不一致により、`hasPassword`が常に`false`となり、🔑アイコンが表示されなかった

## 修正内容

### 修正箇所
- ファイル: `templates/pages/rooms.tmpl`
- 行番号: 1055行目

### 修正前
```javascript
hasPassword: room.password_hash ? true : false,
```

### 修正後
```javascript
hasPassword: room.has_password || false,
```

## 確認した箇所
1. **1055行目**: 修正が必要（上記の通り修正完了）
2. **1246行目**: `room.hasPassword`を参照しており、正しく実装されていることを確認
3. **他のテンプレートファイル**: `password_hash`を参照している箇所がないことを確認

## テスト結果
開発サーバーを起動し、正常に動作することを確認しました。

## 特に注意した点
- サーバー側のAPI仕様（`has_password`フィールド）とテンプレート側のフィールド参照を一致させること
- 同様の問題が他のテンプレートに存在しないか確認すること
- 1166行目では正しく`has_password`を参照していたため、この実装に合わせて修正

## 今後の改善点
- フィールド名の命名規則を統一する（snake_case vs camelCase）
- TypeScriptやリンターを導入して、存在しないフィールドへのアクセスを検出できるようにする
- サーバー側のAPIレスポンスの型定義を明確にし、フロントエンドと共有する

## 関連ファイル
- `templates/pages/rooms.tmpl:1055` - 修正箇所
- `internal/handlers/rooms.go:122,153,704,735` - APIレスポンスでhas_passwordを設定している箇所
- `internal/models/room.go:57-59` - HasPassword()メソッドの定義
