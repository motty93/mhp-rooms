# マイグレーション実行制御機能の実装

## 実装内容

アプリケーション起動時の自動マイグレーション実行を環境変数で制御可能にした。

## 変更前の課題

- アプリケーション起動のたびにマイグレーションが実行される
- 本番環境で不要なマイグレーションチェックが走る
- 起動時間が余計にかかる

## 実装内容

### 1. 環境変数による制御

**config/config.go**
```go
type MigrationConfig struct {
    AutoRun bool
}

Migration: MigrationConfig{
    AutoRun: getEnvBool("RUN_MIGRATION", false),
},
```

### 2. main.goでの条件分岐

**cmd/server/main.go**
```go
if config.AppConfig.Migration.AutoRun {
    log.Println("データベースマイグレーションを実行中...")
    if err := db.Migrate(); err != nil {
        log.Fatalf("マイグレーションに失敗しました: %v", err)
    }
    log.Println("マイグレーション完了")
} else {
    log.Println("マイグレーションはスキップされました（RUN_MIGRATION=trueで有効化）")
}
```

### 3. 専用マイグレーションコマンド

**cmd/migrate/main.go**
- マイグレーション専用の実行ファイル
- 開発・デプロイ時に明示的実行可能

## 使用方法

### 開発時
```bash
# マイグレーション有効でアプリケーション起動
RUN_MIGRATION=true go run cmd/server/main.go

# または専用コマンドでマイグレーション実行
go run cmd/migrate/main.go
```

### 本番環境
```bash
# マイグレーションなしでアプリケーション起動（デフォルト）
go run cmd/server/main.go
```

## メリット

- 本番環境での不要なマイグレーション実行を回避
- 起動時間の短縮
- マイグレーション実行の明示的制御
- デプロイ時の柔軟性向上