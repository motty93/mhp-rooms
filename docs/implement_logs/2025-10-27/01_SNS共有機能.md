# SNS共有機能の実装

## 実装時間
- 開始: 2025-10-27
- 完了: 2025-10-27
- 所要時間: 約1時間

## 概要
部屋詳細画面にSNS共有機能を実装しました。デバイスに応じて最適な共有体験を提供します。

## 実装内容

### 1. SNS共有モーダルコンポーネント（`templates/components/share_modal.tmpl`）
- PC用のモーダルを作成
- 対応SNS:
  - X (旧Twitter)
  - Facebook
  - Bluesky
  - Discord（コピー機能）
- URLコピー機能を実装
- TailwindCSSでスタイリング
- Alpine.jsで状態管理

### 2. シェアボタンの配置

#### モバイル版
- 部屋詳細ヘッダー右側（ハンバーガーメニューの隣）にシェアアイコンを配置
- Web Share APIを使用してシステムの共有UIを表示
- UserAgentでモバイル判定（iPhone、iPad、Android）

#### PC版
- 左パネルヘッダー、設定アイコンの隣にシェアアイコンを配置
- モーダルを表示して各SNSへの共有リンクを提供

### 3. JavaScriptロジック（`templates/pages/room_detail.tmpl`）

実装したメソッド:
- `isMobileDevice()`: UserAgentでモバイル判定
- `openShare()`: デバイスに応じた共有処理を実行
- `closeShareModal()`: モーダルを閉じる
- `copyUrl()`: URLをクリップボードにコピー
- `copyForDiscord()`: Discord用にタイトル+URLをコピー

共有データ:
```javascript
shareMessages: [
  'ハンター募集中！一緒にモンスターを狩ろう！',
  '仲間を募集中！一緒に狩りに出発しよう！',
  'パーティメンバー募集！モンハンで盛り上がろう！',
  '狩り仲間募集中！みんなで協力プレイしよう！',
  'ハンターズ集合！一緒に強敵を倒そう！',
  '部屋主が待ってます！今すぐ狩りに参加しよう！',
  '協力プレイで楽しもう！ハンター大募集！',
  '今すぐ合流しよう！一緒にクエストに挑戦！'
],
shareData: {
  title: '【MHP2G】部屋名 - HuntersHub',
  text: '', // ランダムに選択される
  url: 現在のURL
}
```

共有時の表示例（文言はランダム）:
```
【MHP2G】ティガ狩り部屋 - HuntersHub
ハンター募集中！一緒にモンスターを狩ろう！

https://huntershub.example.com/rooms/xxx
```

または

```
【MHP2G】ティガ狩り部屋 - HuntersHub
狩り仲間募集中！みんなで協力プレイしよう！

https://huntershub.example.com/rooms/xxx
```

※URLの前に改行が2つ入ります（見やすさのため）

### 4. テンプレートパース設定（`internal/handlers/room_detail.go`）
`share_modal.tmpl`をパースファイルリストに追加

## 工夫した点

### 1. デバイス別の最適な体験
- **モバイル**: Web Share APIでネイティブな共有体験を提供
  - 利点: ユーザーが使い慣れたシステムUIを利用できる
  - LINEなど、あらゆる共有先に対応
- **PC**: カスタムモーダルで主要SNSへの直接リンク
  - 利点: 主要SNSへのアクセスが簡単

### 2. フォールバック処理
- Web Share API非対応の場合、PCと同じモーダルを表示
- UserAgent判定で確実にモバイルを識別

### 3. UX/UI設計
- シェアアイコンは控えめなデザイン（グレー）で配置
- ホバー時に濃いグレーに変化
- モーダルはアニメーション付きで表示/非表示
- 各SNSボタンは公式カラーを使用

### 4. Discordへの対応
- Discord公式の共有APIは存在しないため、コピー機能で対応
- タイトル+URLをまとめてコピーできるように実装

### 5. ランダムメッセージ機能
- 共有のたびに8種類の文言からランダムに選択
- 毎回同じ文言だと飽きられる可能性があるため、バリエーションを追加
- ユーザーが共有する際の楽しみを増やす仕掛け

## テスト結果

### サーバー起動確認
- ✅ テンプレートパースエラーなし
- ✅ サーバー正常起動（ポート8095）
- ✅ コンパイルエラーなし

### 実装確認項目
- ✅ モバイル版シェアボタン配置（ヘッダー右側）
- ✅ PC版シェアボタン配置（設定アイコンの隣）
- ✅ SNS共有モーダルコンポーネント作成
- ✅ Alpine.jsバインディング実装
- ✅ JavaScriptロジック実装
- ✅ テンプレートパース設定追加

## 技術スタック
- **フロントエンド**: TailwindCSS, Alpine.js
- **バックエンド**: Go (テンプレート処理)
- **API**: Web Share API（モバイル）

## 今後の改善点

### 1. OGP（Open Graph Protocol）の設定
現在は部屋名とURLのみを共有していますが、以下の追加が望ましい:
- 部屋の説明文
- ゲームバージョンのサムネイル
- メタタグの設定（og:title, og:description, og:image等）

### 2. 共有実績の追跡
- 共有ボタンのクリック数
- どのSNSが多く使われているか
- アナリティクス連携

### 3. 短縮URL対応
- 長いURLを短縮URLに変換
- より見やすい共有メッセージ

### 4. カスタムメッセージ
- 共有時にユーザーがメッセージをカスタマイズできる機能
- プレイ時間帯や募集内容を含めた定型文の提供

## 参考
- GitHub Issue: #50
- Web Share API: https://developer.mozilla.org/ja/docs/Web/API/Navigator/share
