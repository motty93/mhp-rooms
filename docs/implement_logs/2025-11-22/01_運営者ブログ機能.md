# 運営者ブログ機能の実装

## 実装日時
- 開始: 2025-11-22
- 完了: 2025-11-22
- 所要時間: 約1時間

## 概要
Issue #164「運営者ブログページの作成」に基づき、運営者用のブログ機能を実装しました。既存の更新情報機能（`/info`）と同じ仕組みを流用し、マークダウンファイルベースでブログ記事を管理・配信できるようにしました。

## 実装内容

### 1. コンテンツディレクトリとサンプル記事作成
- `content/blog/` ディレクトリを作成
- サンプル記事として「XLink Kaiを使ったMHP2Gオンラインプレイのセットアップガイド」を作成
  - フロントマター: title, slug, date, category, summary, draft
  - カテゴリ: technical（技術情報）

### 2. ブログ用カテゴリの追加
**ファイル**: `internal/info/types.go`

以下の3つのブログ専用カテゴリを追加：
- `ArticleTypeBlogCommunity`: コミュニティ関連の記事
- `ArticleTypeBlogTechnical`: 技術情報（XLink Kai、PSP配信など）
- `ArticleTypeBlogTroubleshooting`: トラブルシューティング

### 3. コンテンツソースへの登録
**ファイル**: `internal/info/content_source.go`

`DefaultContentSources()` に `content/blog` ディレクトリを追加し、デフォルトカテゴリを `ArticleTypeBlogTechnical` に設定。

### 4. BlogHandlerの実装
**ファイル**: `internal/handlers/blog.go`

InfoHandlerをベースに以下の機能を実装：
- `List()`: ブログ一覧表示（カテゴリフィルタリング対応）
- `Detail()`: 個別記事の詳細表示
- `Feed()`: RSS 2.0フィード配信
- `AtomFeed()`: Atomフィード配信

### 5. ルーティング設定
**ファイル**: `cmd/server/routes.go`

以下のルートを追加：
- `GET /blog`: ブログ一覧
- `GET /blog/{slug}`: ブログ詳細
- `GET /blog-feed.xml`: RSSフィード
- `GET /blog-atom.xml`: Atomフィード

### 6. BlogHandlerの初期化
**ファイル**: `cmd/server/application.go`

- Application構造体に `blogHandler` フィールドを追加
- ブログ専用のGeneratorインスタンス（`blogGenerator`）を作成
- `content/blog` ディレクトリのみを対象とする設定
- BlogHandlerの初期化処理を追加

### 7. テンプレート作成
**ファイル**:
- `templates/pages/blog/list.tmpl`: 一覧ページ
- `templates/pages/blog/detail.tmpl`: 詳細ページ

**特徴**:
- カテゴリタブによるフィルタリング（Alpine.js使用）
- RSS/Atomフィードへのリンク表示
- カテゴリバッジの色分け（技術情報: 紫、コミュニティ: 緑、トラブルシューティング: 赤）
- レスポンシブデザイン（Tailwind CSS）
- パンくずリスト対応

### 8. ブログ記事生成スクリプト
**ファイル**: `cmd/generate_blog/main.go`

ブログ記事専用の静的ファイル生成スクリプトを作成：
- `static/generated/blog/articles.json`
- `static/generated/blog/feed.xml`
- `static/generated/blog/atom.xml`

## 技術的な工夫

### 1. Generator の分離
既存の `articleGenerator` と新規の `blogGenerator` を分離することで、更新情報とブログ記事を独立して管理可能に。これにより：
- フィード配信時の記事の混在を防止
- それぞれのカテゴリフィルタリングが正確に動作
- 将来的な拡張性の確保

### 2. 既存機能の再利用
InfoHandlerの実装パターンを踏襲することで：
- 開発時間の短縮
- 一貫性のあるコード品質
- メンテナンス性の向上

### 3. SEO対応
- 適切なメタタグの設定
- RSS/Atomフィード配信
- パンくずリスト実装
- semantic HTMLの使用

## 動作確認

### ビルド確認
```bash
go build -o bin/mhp-rooms cmd/server/*.go
# ビルド成功
```

### 静的ファイル生成
```bash
go run cmd/generate_blog/main.go
# ✓ 1件の記事を処理しました
# ✓ JSONファイルを生成: static/generated/blog/articles.json
# ✓ RSSフィードを生成: static/generated/blog/feed.xml
# ✓ Atomフィードを生成: static/generated/blog/atom.xml
```

### 生成ファイルの確認
- `articles.json`: 記事データが正しくJSON形式で保存
- `feed.xml`: RSSフィードが正しく生成
- `atom.xml`: Atomフィードが正しく生成

## 今後の改善点・課題

### 1. サンプル記事の追加
現在は1件のサンプル記事のみ。以下のような記事を追加予定：
- PSP配信のセットアップガイド
- アドホックパーティの使い方
- よくあるトラブルと解決方法
- コミュニティイベントレポート

### 2. 記事管理の効率化
- マークダウンファイルのテンプレート作成
- 記事作成のワークフロー整備
- プレビュー機能の検討

### 3. UI/UXの改善
- 記事検索機能
- タグ機能の追加
- 関連記事の表示
- 記事へのコメント機能（将来的に）

### 4. フィードの改善
現在のフィードタイトルは「HuntersHub 更新情報」のまま。ブログ専用のタイトルに変更が必要。

### 5. OGP画像対応
ブログ記事のOGP画像生成機能の追加を検討。

## まとめ

既存の更新情報機能を基盤として、約1時間でブログ機能の実装を完了しました。マークダウンベースの記事管理、RSS/Atom配信、カテゴリフィルタリングなど、基本的な機能は全て実装済みです。

今後は記事コンテンツの充実と、ユーザビリティ向上のための追加機能実装を進めていく予定です。

## 関連ファイル

### 新規作成
- `content/blog/2025-11-22-xlink-kai-setup-guide.md`
- `internal/handlers/blog.go`
- `templates/pages/blog/list.tmpl`
- `templates/pages/blog/detail.tmpl`
- `cmd/generate_blog/main.go`

### 修正
- `internal/info/types.go`
- `internal/info/content_source.go`
- `cmd/server/routes.go`
- `cmd/server/application.go`

## テスト状況
- ビルド: ✅ 成功
- 静的ファイル生成: ✅ 成功
- JSON生成: ✅ 正常
- RSSフィード: ✅ 生成確認
- Atomフィード: ✅ 生成確認
