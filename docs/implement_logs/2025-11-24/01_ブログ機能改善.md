# ブログ機能改善（Zennスタイル対応）

## 実装日時
- 開始: 2025-11-24
- 完了: 2025-11-24
- 所要時間: 約2時間

## 概要
既存のブログ機能をZennスタイルのレイアウトに刷新し、読了時間表示、目次機能、ヘッダーナビゲーションを追加しました。

## 実装内容

### 1. 読了時間計算機能の実装
**ファイル**: `internal/info/parser.go`, `internal/info/types.go`

記事の読了時間を自動計算する機能を追加：
- 日本語の平均読書速度（500文字/分）で計算
- マークダウンのメタデータと記法を除外した正味の文字数をカウント
- Article構造体に`ReadingTime int`フィールドを追加

```go
// 読了時間を計算（日本語: 500文字/分）
func calculateReadingTime(content string) int {
    // マークダウンのメタデータ部分を除外
    parts := strings.SplitN(content, "---", 3)
    if len(parts) >= 3 {
        content = parts[2]
    }

    // マークダウン記法を除外
    content = strings.ReplaceAll(content, "#", "")
    // ... 他の記号も除外

    charCount := utf8.RuneCountInString(content)
    minutes := charCount / 500
    if minutes < 1 {
        return 1
    }
    return minutes
}
```

### 2. 一覧ページのレイアウト刷新
**ファイル**: `templates/pages/blog/list.tmpl`

Zennスタイルのコンパクトな横型カードレイアウトに変更：
- **レイアウト**: 2列グリッド（`grid md:grid-cols-2`）
- **カード形式**: 横型（128px正方形サムネイル + テキスト）
- **固定高**: `h-32`でカードの高さを統一
- **読了時間**: 「約○分」形式で表示
- **カテゴリ色分け**:
  - 技術情報: 紫（`bg-purple-100`）
  - コミュニティ: 緑（`bg-green-100`）
  - トラブルシューティング: 赤（`bg-red-100`）

**重要な修正**:
- 初回実装では`<a>`タグに高さ指定がなく、カードが縦に伸びる問題があった
- `<a>`タグに`h-32`を追加し、`<article>`は`h-full`で親の高さに合わせることで解決

### 3. 詳細ページのサイドバーと目次追加
**ファイル**: `templates/pages/blog/detail.tmpl`

2カラムレイアウトで目次とシェアボタンを追加：
- **2カラムレイアウト**: `flex flex-col lg:flex-row gap-8`
- **サイドバー**: デスクトップのみ表示（`lg:block`）、`sticky top-8`で追従
- **目次自動生成**: JavaScriptでh2とh3見出しから目次を生成
- **スムーススクロール**: 目次リンククリックで該当見出しにスクロール
- **シェアボタン**: Twitter、LINE（将来実装用UI）

**目次生成ロジック**:
```javascript
const headings = content.querySelectorAll('h2, h3');
headings.forEach((heading, index) => {
    if (!heading.id) {
        heading.id = `heading-${index}`;
    }
    // 目次リンクを生成
});
```

### 4. ヘッダーナビゲーションの追加
**ファイル**: `templates/components/header.tmpl`

「ホーム | ブログ | 部屋一覧 | お問い合わせ」のナビゲーションを追加：
- **デスクトップ**: ロゴとログインボタンの間に配置（`lg:flex`）
- **モバイル**: ハンバーガーメニュー内に配置
- **両方のヘッダー**: StaticPageと通常ページの両方に実装

### 5. HideHeaderフラグの削除
**ファイル**: `internal/handlers/blog.go`

ブログページでヘッダーが表示されるように修正：
- `HideHeader: true`を削除
- `StaticPage: true`のみ設定

## 技術的なポイント

### 1. レスポンシブデザイン
- **ブレークポイント**:
  - モバイル: デフォルト（カード1列、サイドバー非表示）
  - タブレット: `md:`（カード2列）
  - デスクトップ: `lg:`（ナビゲーション表示、サイドバー表示）

### 2. Tailwind CSSのカスタマイズ
- Proseプラグインのカスタマイズ（`prose-h2:border-b`, `prose-h3:text-xl`など）
- スクロールマージン設定（`prose-headings:scroll-mt-20`）で目次ジャンプ時の位置調整

### 3. Alpine.jsによるカテゴリフィルタリング
```javascript
x-data="{ category: '{{ .PageData.CurrentCategory }}' }"
x-show="category === 'all' || category === '{{ .Category }}'"
```

## 動作確認

### ビルド確認
```bash
go build -o bin/mhp-rooms cmd/server/*.go
# ビルド成功
```

### 静的ファイル生成
```bash
go run cmd/generate_blog/main.go
# ✓ JSONファイルを生成: static/generated/blog/articles.json
# ✓ RSSフィードを生成: static/generated/blog/feed.xml
# ✓ Atomフィードを生成: static/generated/blog/atom.xml
```

### UI確認（Playwright）
- ✅ 一覧ページ: 横型カード、固定高、2列グリッド
- ✅ 詳細ページ: サイドバー、目次、読了時間表示
- ✅ ヘッダー: ナビゲーションリンク表示
- ✅ レスポンシブ: モバイル、タブレット、デスクトップで適切に表示

## 今後の改善点・課題

### 1. トップページへの最新記事セクション追加
ホームページに最新3件のブログ記事を表示するセクションを追加。

### 2. OGP画像生成
記事ごとにOGP画像を自動生成する機能の実装。

### 3. SEO強化
- 構造化データ（JSON-LD）の追加
- より詳細なOGPタグの設定
- サイトマップへのブログページ追加

### 4. 記事コンテンツの充実
現在は1件のサンプル記事のみ。以下のような記事を追加予定：
- PSP配信のセットアップガイド
- アドホックパーティの使い方
- よくあるトラブルと解決方法
- コミュニティイベントレポート

### 5. 追加機能
- 記事検索機能
- タグ機能
- 関連記事の表示
- コメント機能（将来的に）

## まとめ

Zennスタイルのブログレイアウトを実装し、読了時間表示、目次機能、ヘッダーナビゲーションを追加しました。これにより、ユーザーが記事を読みやすく、サイト内を回遊しやすいUIになりました。

今後は記事コンテンツの充実とSEO強化を進めていく予定です。

## 関連ファイル

### 修正
- `internal/info/parser.go` - 読了時間計算機能追加
- `internal/info/types.go` - Article構造体にReadingTimeフィールド追加
- `templates/pages/blog/list.tmpl` - Zennスタイルレイアウトに刷新
- `templates/pages/blog/detail.tmpl` - サイドバーと目次追加
- `templates/components/header.tmpl` - ナビゲーションリンク追加
- `internal/handlers/blog.go` - HideHeaderフラグ削除

## テスト状況
- ビルド: ✅ 成功
- 静的ファイル生成: ✅ 成功
- 一覧ページUI: ✅ 正常
- 詳細ページUI: ✅ 正常
- 目次機能: ✅ 正常
- ヘッダーナビゲーション: ✅ 正常
- レスポンシブ: ✅ 正常
