# プロフィール画面「作成した部屋」の実データ表示修正

実装時間: 約20分

## 実装内容

プロフィール画面の「作成した部屋」セクションで、モックデータではなく実際のデータを表示するように修正しました。

### 問題点

1. 開発環境でのユーザー処理が認証済みユーザーを無視していた
2. 初期表示でモックデータ（`getMockRooms()`）が使用されていた

### 修正内容

#### 1. 開発環境のフォールバック処理を削除

**修正前**:
```go
user := getUserFromContext(r.Context())
if user == nil {
    // 開発環境: 認証がない場合はテストユーザーを使用
    if os.Getenv("ENV") != "production" {
        devUser, err := ph.repo.User.FindUserByEmail("hunter1@example.com")
        // ...
    }
}
```

**修正後**:
```go
user := getUserFromContext(r.Context())
if user == nil {
    http.Redirect(w, r, "/auth/login", http.StatusFound)
    return
}
```

#### 2. 初期表示でも実データを取得

**修正前**:
```go
profileData := ProfileData{
    // ...
    Rooms: ph.getMockRooms(),
    // ...
}
```

**修正後**:
```go
// 実際に作成した部屋を取得
rooms, err := ph.repo.Room.GetRoomsByHostUser(user.ID, 10, 0) // 最大10件取得
var roomSummaries []RoomSummary
if err == nil {
    for _, room := range rooms {
        roomSummaries = append(roomSummaries, roomToSummary(room))
    }
}

profileData := ProfileData{
    // ...
    Rooms: roomSummaries,
    // ...
}
```

### 修正ファイル

- `/internal/handlers/profile.go`
  - `Profile`メソッド
  - `UserProfile`メソッド  
  - `Rooms`メソッド（開発環境処理削除）

## 技術的な詳細

### データ取得フロー

1. 認証済みユーザーのIDを取得
2. `GetRoomsByHostUser`でホストの部屋を取得
3. `roomToSummary`で表示用データに変換
4. 初期表示とタブクリック時の両方で実データを使用

### セキュリティ考慮

- 認証されていないユーザーはログインページへリダイレクト
- 開発環境でも本番環境と同じ認証フローを使用

## テスト結果

1. 認証済みユーザーでのプロフィール表示
   - 初期表示で実際に作成した部屋が表示される ✓
   - タブクリック時も同じデータが表示される ✓

2. 開発環境での動作
   - 認証なしでアクセスするとログインページへリダイレクト ✓
   - 認証済みユーザーの部屋のみ表示される ✓

## 今後の改善点

1. ページネーション機能の追加（現在は最大10件まで）
2. 部屋の状態（アクティブ/終了）でのフィルタリング
3. 作成日時でのソート機能